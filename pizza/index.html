<!DOCTYPE html>
<html lang="en">
<head>
    <title>Smalltown Pizzeria</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8E4D3;
            color: #8B4513;
            margin: 0;
            overflow: hidden;
        }

        #info {
            color: #8B0000;
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display: block;
            font-size: 1.2em;
        }

        #info a, .button {
            color: #D2691E;
            font-weight: bold;
            text-decoration: underline;
            cursor: pointer;
        }

        h1 {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            z-index: 101;
            font-size: 3em;
            color: #FF4500;
            text-shadow: 2px 2px #8B0000;
            margin: 0;
        }

        #pizza-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://i.imgur.com/JRWqG7R.jpg') center center / cover no-repeat;
            opacity: 0.2;
            z-index: 0;
        }
    </style>
</head>

<body>
    <div id="pizza-overlay"></div>
    <h1>Welcome to Smalltown Pizzeria</h1>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r54/three.js"></script>

    <script>
        var container;

        var camera, scene, renderer;

        var mouseX = 0, mouseY = 0;

        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;

        var subPizzaRatio = 0.1;
        var crustRatio = 0.1;
        var cheeseRatio = crustRatio * 0.2;
        var numSubPizzas = 20;
        var numGiveUp = 3000;
        var recursionDepth = 4;
        var crustColors = [0xD2691E, 0xA0522D, 0x8B4513, 0xCD853F, 0xF4A460];
        var cheeseColors = [0xFFD700, 0xFFC300, 0xFFA500, 0xFF8C00, 0xFF4500];

        init();
        animate();

        function pizza(scene, posX, posY, posZ, dim, res, depth) {
            var toriodGeometry = new THREE.TorusGeometry(dim, dim * crustRatio, res, res);
            var cylinderGeometry = new THREE.CylinderGeometry(dim - dim * crustRatio, dim - dim * crustRatio, dim * cheeseRatio, res);
            var crust = new THREE.Mesh(toriodGeometry, new THREE.MeshLambertMaterial({ color: crustColors[depth] }));
            crust.position.set(posX, posY, posZ);
            scene.add(crust);

            var cheese = new THREE.Mesh(cylinderGeometry, new THREE.MeshLambertMaterial({ color: cheeseColors[depth] }));
            cheese.position.set(posX, posY, posZ);
            cheese.rotation.x = Math.PI / 2;
            scene.add(cheese);
        }

        function recPizza(scene, posX, posY, posZ, dim, depth) {
            pizza(scene, posX, posY, posZ, dim, Math.floor(40 / depth), depth - 1);
            if (depth >= recursionDepth) return;

            var i, j, subPizzas = 0;
            var subPizzaRadius = dim * subPizzaRatio;
            var insideDim = dim - dim * crustRatio - subPizzaRadius * 3;
            var subPizzaDims = [];
            var randomDim, dst, doRender;

            for (i = 0; i < numGiveUp && subPizzas < numSubPizzas / Math.pow(2, depth - 1); i++) {
                doRender = true;
                randomDim = [insideDim * (Math.random() * 2 - 1), insideDim * (Math.random() * 2 - 1)];
                for (j = 0; j < subPizzaDims.length; j++) {
                    dst = Math.sqrt(
                        Math.pow(randomDim[0] - subPizzaDims[j][0], 2) +
                        Math.pow(randomDim[1] - subPizzaDims[j][1], 2)
                    );
                    if (dst < 3 * subPizzaRadius) {
                        doRender = false;
                        break;
                    }
                }
                if (doRender) {
                    subPizzaDims.push(randomDim);
                    recPizza(scene, posX + randomDim[0], posY + randomDim[1], posZ + dim * cheeseRatio, subPizzaRadius, depth + 1);
                    subPizzas++;
                }
            }
        }

        function init() {
            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.z = 100;

            scene = new THREE.Scene();

            var ambient = new THREE.AmbientLight(0x404040);
            scene.add(ambient);

            var directionalLight = new THREE.DirectionalLight(0xffeedd);
            directionalLight.position.set(0, 0, 1).normalize();
            scene.add(directionalLight);

            recPizza(scene, 0, 0, 0, 100, 1);

            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onDocumentMouseMove(event) {
            mouseX = (event.clientX - windowHalfX) / 2;
            mouseY = (event.clientY - windowHalfY) / 2;
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            camera.position.x += (mouseX - camera.position.x) * 0.05;
            camera.position.y += (-mouseY - camera.position.y) * 0.05;

            camera.lookAt(scene.position);

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
